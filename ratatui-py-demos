#!/usr/bin/env python3
import os
import sys
from pathlib import Path

ROOT = Path(__file__).resolve().parent
SRC = ROOT / "src"
sys.path.insert(0, str(SRC))

# Optional debug-friendly environment: enable with RATATUI_PY_DEBUG=1
if os.getenv("RATATUI_PY_DEBUG"):
    os.environ.setdefault("RUST_BACKTRACE", "full")
    os.environ.setdefault("RATATUI_FFI_TRACE", "1")
    os.environ.setdefault("RATATUI_FFI_NO_ALTSCR", "1")
    os.environ.setdefault("RATATUI_FFI_PROFILE", "debug")
    os.environ.setdefault("RATATUI_FFI_LOG", str(ROOT / "ratatui_ffi.log"))

debug = os.getenv("RATATUI_PY_DEBUG")
def dprint(msg: str) -> None:
    if debug:
        sys.stderr.write(msg + "\n")
        sys.stderr.flush()

dprint("[ratatui-py-demos] start")

# ensure shared lib is present for runtime
try:
    from ratatui_py._bootstrap import ensure_runtime_lib
    dprint("[ratatui-py-demos] ensuring runtime lib")
    ensure_runtime_lib()
    dprint("[ratatui-py-demos] runtime lib ok")
except Exception as e:
    dprint(f"[ratatui-py-demos] bootstrap skipped: {e}")

from ratatui_py.demo_runner import run_demo_hub

if __name__ == "__main__":
    dprint("[ratatui-py-demos] launching hub")
    try:
        run_demo_hub()
    except Exception as e:
        dprint(f"[ratatui-py-demos] error: {e}")
        raise
